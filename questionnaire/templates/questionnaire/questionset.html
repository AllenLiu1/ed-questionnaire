{% extends "base.html" %}
{% load markup questionnaire i18n %}

{% block headextra %}
    <script type="text/javascript" src="/static/questionset.js"></script>
    {% for x in jsinclude %}
        <script type="text/javascript" src="{{ x }}"></script>
    {% endfor %}
    
    {% for x in cssinclude %}
        <link rel="stylesheet" href="{{ x }}" type="text/css" />
    {% endfor %}
{% endblock %}

{% block language %}
    {% for lang in LANGUAGES %}{% if not forloop.first %} |{% endif %}
        <a href="{{request.path}}?lang={{ lang.0 }}">{{ lang.1 }}</a>
    {% endfor %}
{% endblock %}

{% block styleextra %}
    .required {
        font-weight: bold;
    }

    .qnumber {
        font-weight: bold;
    }

    .question-text {
        font-size: 1.3em;
    }

    .answer label {
        font-size: 14px !important;
    }

    div.input {
        margin-left: 35px;
    }

    .answer {
        margin: 5px 0 25px 0;
        padding: 0;
        border-top: 1px solid #dadada;
    }

    div.input input[type="text"], div.input textarea, div.input select {
        margin: 8px 0 0 0;        
    }

    ul.inputs-list input[type="text"] {
        margin: 5px 0;
    }

    .questionset-title {
        margin: 0 0 25px 0;
    }

    img.percentImage {
     background: white url(/static/progress/percentImage_back4.png) top left no-repeat;
     padding: 0;
     margin: 5px 0 0 0;
     background-position: 1px 0;
    }

    .error {
        margin: 10px 0;
    }

    .back-link {
        margin-top: -68px;
        margin-left: 25px;
        position: absolute;
    }

    .questionset-submit {
        margin-top: 60px;
    }

{% endblock %}

{% block content %}

    {% if progress %}
        <p style="text-align: center;">
            <img alt="{{ progress.0 }}" src="/static/progress/percentImage.png" class="percentImage" style="background-position: {{ progress.1 }}px 0pt;" /> 
        {{ progress.0 }}% complete.
        </p>
    {% endif %}

    <div class="questionset-title">
    {{ questionset.text|textile }}
    </div>

    <form name="qform" id="qform" action="{{ request.path }}" method="POST">
    
        <input type="hidden" name="questionset_id" value="{{ questionset.id }}">
    
        {% for question, qdict in qlist %}
        {% with errors|dictget:question.number as error %}

            <div class="question type_{{ qdict.qtype }} {% if error %} error prepend-top{% endif %}{{ qdict.qnum_class }}{{ qdict.qalpha_class }}" id="qc_{{ question.number }}" {{qdict.checkstring|safe}}>                
                {% if request.user.is_staff %}
                    <span class="pull-right">
                        <a href="/admin/questionnaire/question/{{ question.id }}/">
                            ({% trans "edit" %} {{ question.number }})
                        </a>
                    </span>
                {% endif %}
                    
                {% if qdict.custom %}
                    {% if error %}
                        <div class="error">
                            {{ error }}
                        </div>
                    {% endif %}
                    {% include qdict.template %}
                {% else %}
                    <div class="question-text {% if qdict.required %}required{% endif %}">
                        <span class="qnumber">{{ question.display_number }}.</span> 
                        {{ question.text }}
                    </div>
                    <div class="answer">
                        {% if error %}
                            <div class="alert-message block-message error input"><strong>{{ error }}</strong></div>
                        {% endif %}
                        {% include qdict.template %}
                    </div>
                {% endif %}
            </div> <!-- /question container -->
        {% endwith %}
        {% endfor %}
    
        
            
            <div style="text-align: center;" class="well questionset-submit">
                <input class="btn large primary" name="submit" type="submit" value="{% trans "Continue" %}">
                
            </div>
            
            {% if questionset.prev %}
                <a class="back-link pull-left" href="javascript:history.back();">{% trans "return to previous page" %}</a>
            {% endif %}
    </form>

    <script type="text/javascript">
        {% for trigger in triggers %}
            addtrigger("{{trigger}}");
        {% endfor %}
        
        {% for k,v in qvalues.items %}
            qvalues['{{ k|escapejs }}'] = '{{ v|escapejs }}';
        {% endfor %}
        
        for(key in qvalues) {
            valchanged(key, qvalues[key]);
        }
    </script>
{% endblock %}
